# ユーザー管理システム - 要件定義（EAVモデル）# Todoアプリケーション - 要件定義



## 📋 概要## 📋 概要



**EAV（Entity-Attribute-Value）モデル**を使った柔軟なユーザー管理システムです。データベース（SQLite + Entity Framework Core）を使ったCRUDアプリケーションを通じて、以下を学習します：

会社の実務で使われているような、動的に属性を追加できる設計を学習します。

- Entity Framework Coreの基本操作

### なぜEAVモデルを使うのか？- 非同期処理（async/await）

- データベースマイグレーション

従来の固定カラム方式では、新しい属性を追加するたびにデータベーススキーマ変更（マイグレーション）が必要です。- サーバー/クライアント責務分離

EAVモデルを使えば、コードを変更せずに**管理画面から属性を追加**できます。

## 🎯 機能要件

**従来方式（固定カラム）**:

```sql### 1. Todoの一覧表示 (Read)

Users テーブル:- すべてのTodoアイテムを一覧表示

| Id | Name | Age | Department | PhoneNumber | ... |- 完了/未完了のステータス表示

```- 作成日時の表示

→ 新しい属性（例: BloodType）を追加するには、ALTER TABLEが必要

### 2. Todoの新規作成 (Create)

**EAV方式**:- タイトル入力（必須、最大100文字）

```sql- 説明入力（任意、最大500文字）

Users テーブル: | Id | Name |- 期限日時の設定（任意）

Attributes テーブル: | Id | AttributeName | DataType |- バリデーションエラー表示

UserAttributeValues テーブル: | UserId | AttributeId | Value |

```### 3. Todoの編集 (Update)

→ Attributesテーブルに新しい行を追加するだけ！- 既存Todoの内容変更

- 完了/未完了のトグル

## 🎯 機能要件- バリデーション実施



### 1. ユーザー管理（基本CRUD）### 4. Todoの削除 (Delete)

- 確認ダイアログ表示

- **一覧表示**: すべてのユーザーを表示- 物理削除（実際にレコード削除）

- **詳細表示**: ユーザーの基本情報と全属性値を表示

- **新規作成**: 名前とメールアドレスを登録、属性値も同時入力## 📊 データモデル

- **編集**: ユーザー情報と属性値を更新

- **削除**: ユーザーを削除（関連する属性値も削除）### Todoエンティティ



### 2. 属性管理（動的スキーマ）| プロパティ | 型 | 必須 | 説明 |

|---------|------|------|------|

- **属性定義の作成**: 新しい属性を定義（例: "年齢", "部署", "役職"）| Id | int | ○ | 主キー（自動採番） |

- **属性一覧**: 定義済みの属性を表示| Title | string | ○ | タイトル（最大100文字） |

- **データ型サポート**: Text（文字列）、Number（数値）、Date（日付）| Description | string | - | 説明（最大500文字） |

- **属性編集**: 属性名やデータ型を変更| IsCompleted | bool | ○ | 完了フラグ（デフォルト: false） |

- **属性削除**: 属性を削除（使用中の場合は警告）| DueDate | DateTime? | - | 期限日時 |

| CreatedAt | DateTime | ○ | 作成日時（自動設定） |

## 📊 データモデル（EAV構造）| UpdatedAt | DateTime | ○ | 更新日時（自動更新） |



### 1. Users（ユーザーエンティティ）## 🔧 技術要件



| プロパティ | 型 | 必須 | 説明 |### 使用技術スタック

|---------|------|------|------|- ASP.NET Core MVC (net9.0)

| Id | int | ○ | 主キー（自動採番） |- Entity Framework Core 9.x

| Name | string | ○ | ユーザー名（最大100文字） |- SQLite（ファイルベースDB）

| Email | string | ○ | メールアドレス（ユニーク） |- Tag Helpers（Razor）

| CreatedAt | DateTime | ○ | 作成日時 |- Data Annotations（検証）

| UpdatedAt | DateTime | ○ | 更新日時 |

### 非機能要件

### 2. Attributes（属性定義）- すべてのDB操作は非同期（async/await）

- CSRF対策（ValidateAntiForgeryToken）

| プロパティ | 型 | 必須 | 説明 |- サーバーサイド検証必須

|---------|------|------|------|- クライアントサイド検証推奨

| Id | int | ○ | 主キー（自動採番） |

| AttributeName | string | ○ | 属性名（例: "年齢", "部署"） |## 🎨 画面設計

| DataType | string | ○ | データ型（Text/Number/Date） |

| DisplayOrder | int | ○ | 表示順序 |### 1. 一覧画面 (`/TodoApp/Todo/Index`)

| IsRequired | bool | ○ | 必須フラグ |```

| CreatedAt | DateTime | ○ | 作成日時 |+------------------------------------------+

| 📝 Todo一覧                    [新規作成] |

### 3. UserAttributeValues（属性値）+------------------------------------------+

| □ タイトル1          期限: 2025/12/31    |

| プロパティ | 型 | 必須 | 説明 ||   説明文...           [編集] [削除]      |

|---------|------|------|------|+------------------------------------------+

| Id | int | ○ | 主キー（自動採番） || ☑ タイトル2 (完了)    期限: なし         |

| UserId | int | ○ | ユーザーID（外部キー） ||   説明文...           [編集] [削除]      |

| AttributeId | int | ○ | 属性ID（外部キー） |+------------------------------------------+

| Value | string | ○ | 値（すべて文字列で保存） |```

| CreatedAt | DateTime | ○ | 作成日時 |

| UpdatedAt | DateTime | ○ | 更新日時 |### 2. 新規作成画面 (`/TodoApp/Todo/Create`)

```

**リレーション**:+------------------------------------------+

- User ←1対多→ UserAttributeValue| 📝 新規Todo作成                           |

- Attribute ←1対多→ UserAttributeValue+------------------------------------------+

| タイトル*: [________________]            |

## 🎨 画面設計| 説明:      [________________]            |

|           [________________]            |

### 1. ユーザー一覧画面 (`/UserManagement/User/Index`)| 期限:      [____/__/__] [__:__]         |

|                                          |

```|           [作成] [キャンセル]             |

+----------------------------------------------------------++------------------------------------------+

| 👥 ユーザー一覧                         [新規ユーザー作成] |```

+----------------------------------------------------------+

| ID | 名前        | メールアドレス         | 操作         |### 3. 編集画面 (`/TodoApp/Todo/Edit/{id}`)

|----|------------|----------------------|--------------|```

| 1  | 青木拓馬    | aoki@example.com     | [詳細][編集][削除] |+------------------------------------------+

| 2  | 山田太郎    | yamada@example.com   | [詳細][編集][削除] || ✏️ Todo編集                               |

+----------------------------------------------------------++------------------------------------------+

```| タイトル*: [既存のタイトル]               |

| 説明:      [既存の説明]                   |

### 2. ユーザー詳細画面 (`/UserManagement/User/Details/{id}`)| 期限:      [2025/12/31 23:59]            |

| 完了:      ☑                             |

```|                                          |

+----------------------------------------------------------+|           [保存] [キャンセル]             |

| 👤 ユーザー詳細                        [編集] [削除] [戻る] |+------------------------------------------+

+----------------------------------------------------------+```

| 基本情報:

| 名前: 青木拓馬### 4. 削除確認画面 (`/TodoApp/Todo/Delete/{id}`)

| メールアドレス: aoki@example.com```

| 作成日: 2025/11/08 10:00+------------------------------------------+

|| 🗑️ Todo削除確認                           |

| 属性情報:+------------------------------------------+

| 年齢: 25| 以下のTodoを削除してもよろしいですか？      |

| 部署: 開発部|                                          |

| 役職: エンジニア| タイトル: タイトル1                       |

| 入社日: 2023/04/01| 説明: 説明文...                          |

+----------------------------------------------------------+| 作成日: 2025/11/01                       |

```|                                          |

|           [削除] [キャンセル]             |

### 3. ユーザー編集画面 (`/UserManagement/User/Edit/{id}`)+------------------------------------------+

```

```

+----------------------------------------------------------+## 🚦 バリデーションルール

| ✏️ ユーザー編集                                            |

+----------------------------------------------------------+### タイトル

| 基本情報:- 必須入力

| 名前*:         [青木拓馬                    ]- 最大100文字

| メール*:       [aoki@example.com           ]- エラーメッセージ: "タイトルを入力してください"

|

| 属性情報:### 説明

| 年齢 (数値):   [25                         ]- 任意入力

| 部署 (文字):   [開発部                      ]- 最大500文字

| 役職 (文字):   [エンジニア                   ]- エラーメッセージ: "説明は500文字以内で入力してください"

| 入社日 (日付): [2023-04-01                 ]

|### 期限日時

|                               [保存] [キャンセル]- 任意入力

+----------------------------------------------------------+- 過去日時も許可（既に期限切れのタスクも登録可能）

```

## 🔐 セキュリティ要件

### 4. 属性管理画面 (`/UserManagement/Attribute/Index`)

1. **CSRF対策**: すべてのPOSTアクションに`[ValidateAntiForgeryToken]`

```2. **SQLインジェクション対策**: EF Coreのパラメータ化クエリ使用

+----------------------------------------------------------+3. **XSS対策**: Razorの自動エスケープ機能活用

| 🏷️ 属性管理                               [新規属性追加] |

+----------------------------------------------------------+## 📈 拡張性の考慮

| ID | 属性名  | データ型 | 必須 | 表示順 | 操作      |

|----|--------|---------|------|--------|-----------|将来的に以下の機能追加を想定：

| 1  | 年齢    | Number  | ○   | 1      | [編集][削除] |

| 2  | 部署    | Text    | ○   | 2      | [編集][削除] |- カテゴリ/タグ機能

| 3  | 役職    | Text    | -   | 3      | [編集][削除] |- 優先度設定

| 4  | 入社日  | Date    | ○   | 4      | [編集][削除] |- ユーザー認証（複数ユーザー対応）

+----------------------------------------------------------+- ソート・フィルタリング機能

```- ページネーション

- 論理削除（IsDeleted フラグ）

## 🔧 技術要件

## 🎓 学習目標

### 使用技術スタック

- ASP.NET Core MVC (net9.0)このTodoアプリ実装を通じて、以下のスキルを習得します：

- Entity Framework Core 9.x

- SQLite（ファイルベースDB）1. **EF Core基礎**

- Razor Views（従来型MVC、Ajaxなし）   - DbContext設定

- Data Annotations（検証）   - マイグレーション実行

   - CRUD操作（async/await）

### 非機能要件

- すべてのDB操作は非同期（async/await）2. **MVCパターン実践**

- CSRF対策（ValidateAntiForgeryToken）   - Entity（データベーステーブル）

- 参照整合性の保持（外部キー制約）   - ViewModel（画面表示用）

   - Controller（ビジネスロジック）

## 🔐 バリデーションルール   - View（UI）の役割分離



### User3. **非同期プログラミング**

- **Name**: 必須、最大100文字   - async/awaitの正しい使い方

- **Email**: 必須、Email形式、ユニーク制約   - ToListAsync(), FirstOrDefaultAsync()など



### Attribute4. **データベース設計**

- **AttributeName**: 必須、最大50文字   - 主キー設定

- **DataType**: 必須、"Text", "Number", "Date" のいずれか   - インデックス考慮

- **DisplayOrder**: 必須、1以上の整数   - データ型選択



### UserAttributeValue---

- **Value**: 必須、最大500文字

- **データ型検証**: Attribute.DataTypeに応じて検証次のステップ: `er-diagram.md`でデータベース設計を確認してください。

  - Number型: 数値のみ許可
  - Date型: 日付形式のみ許可

## 🎓 学習目標

このシステム実装を通じて、以下のスキルを習得します：

1. **EAVモデルの理解**
   - 動的スキーマ設計の考え方
   - メリット・デメリットの理解
   - 実務での使いどころ

2. **複雑なリレーション**
   - 1対多の関係（User → UserAttributeValue）
   - ナビゲーションプロパティ
   - Include/ThenInclude によるEager Loading

3. **動的UI生成**
   - 属性定義に基づくフォーム生成
   - データ型に応じたバリデーション
   - 柔軟なビューモデル設計

4. **EF Coreの高度な機能**
   - 複合クエリ
   - トランザクション管理
   - カスケード削除

---

次のステップ: `er-diagram.md`でEAVモデルのデータベース設計を確認してください。
